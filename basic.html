<!DOCTYPE html>
<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js">
</script>
<script type="text/javascript">


$(document).ready(function () {
  $('#create').click(function(){
    const esr_gen_base = "http://ec2-35-164-49-130.us-west-2.compute.amazonaws.com";
    let testnet_checkbox = document.getElementById("testmode");
    if (testnet_checkbox.checked) {
      var esr_gen_url = esr_gen_base + '/qrt';
      var contract = "c1111seattle";
    } else {
      var esr_gen_url = esr_gen_base + '/qr';
      var contract = "microbadger2";
    }
    var type = document.getElementById("type");
    transaction =  {actions: [{account: contract,
        name: type.value, data: { issuer: document.getElementById("issuer_account").value,
        badge: document.getElementById("badge_name").value,
        badgee: document.getElementById("badgee_account").value,
        memo: document.getElementById("memo_text").value,
        jsonmemo: document.getElementById("memo_json").value },
      authorization: [{actor: "............1", permission: "active"}]
      }]
    };

    $.ajax({
      type: "POST",
      url: esr_gen_url,
      data: JSON.stringify(transaction),
      contentType: "application/json; charset=utf-8",
      dataType: "json",
      success: function(data, status, jqXHR) {
        qr_url = data.qr.replace("https","http"); 
        qrcode.innerHTML = `<img src=${qr_url}>`;
        esr.innerHTML = data.esr;
      },
      error: function(xhr, status, error) {
        esr.innerHTML = xhr.responseText;
      }
    });
    // TBD: check blockchain for transaction posted, or timeout?
  });
  $('#clear').click(function(){
    qrcode.innerHTML = ``;
    esr.innerHTML = ``;
  });
});
</script>
</head>

<body>

<h2>microbadge actions</h2>

<input type="button" value="List badge events" 
       onclick="window.location.assign('reporter.html')" />
<p>
<label for="testmode">Use Testnet:</label> 
<input type="checkbox" id="testmode" >
</p>

<form name="badge-data" class="badge-form" ">

  <label for="issuer_account">Issuer Account:<input type="text" maxlength="12" id="issuer_account" name="issuer_account" value="">
  </label><br>
  <label for="badge_name">Badge name:<input type="text" id="badge_name" name="badge_name" value="">
  </label><br>
  <label for="badgee_account">Badgee Account:<input type="text" maxlength="12" id="badgee_account" name="badgee_account" value="">
  </label><br>
  <label for="memo_text">Memo (free text):<input type="text" id="memo_text" name="memo_text" value="">
  </label><br>
  <label for="memo_json">Memo (json):<input type="text" id="memo_json" name="memo_json" value="">
  </label><br>
  <p>
  <label for="type">Choose an action:</label>
  <select name="type" id="type">
    <option value="init">Issue badge</option>
    <option value="cancel">Cancel badge</option>
    <option value="issuerupdate">Update badge (by issuer)</option>
    <option value="badgeeupdate">Update badge (by badgee)</option>
    <option value="badgeereject">Reject badge (by badgee)</option>
  </select>
  </p>
  <div id="button-wrapper">
    <input type="button" id="create" value="Create QR">
    <input type="button" id="clear" value="Clear result">
  </div>
</form>

<div id=qrcode> </div>
<div id=esr> </div>

</body>
</html>

